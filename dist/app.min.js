"use strict";var GAME={colors:["green","red","blue","yellow"],started:false,pauseInput:true,gameSounds:{loaded:false,loading:false},animationId:-1,resetting:false,touchTimeout:false,setupGame:function t(){this.sequence=[];for(var e=0;e<20;e++){var n=this.colors[Math.floor(Math.random()*this.colors.length)];this.sequence.push(n)}this.playerLevel=1;this.playerSequence=[];this.pauseInput=true;this.playCurrentLevel()},startGame:function t(){this.started=true;this.setMainBtn("Loading...");var e=this;this.initSounds().then(function(){e.setMainBtn("Reset");e.setupGame()})},resetGame:function t(){this.pauseInput=true;this.resetting=true;this.animationId=-1;this.setMainBtn("Loading...");setTimeout(function(){this.setupGame();this.setMainBtn("Reset");this.resetting=false}.bind(this),1500)},playCurrentLevel:function t(){this.setLevelField();this.setStrictField();this.pauseInput=true;setTimeout(function(){this.playSequence(this.playerLevel).then(function(){this.pauseInput=false}.bind(this))}.bind(this),1500)},checkInput:function t(e){for(var n=0,i=e.length;n<i;n++){if(e[n]===this.sequence[n]){continue}return false}return true},resetPlayerInput:function t(){this.playerSequence=[]},input:function t(e){if(this.colors.indexOf(e)==-1){throw new Error("Tried to input an invalid color: "+e);return}var n=this.playerSequence.slice(0);n.push(e);if(this.checkInput(n)){this.playerSequence=n;if(this.playerSequence.length>=this.playerLevel){this.increasePlayerLevel()}return true}else{this.doFailureState();return false}},increasePlayerLevel:function t(){this.playerLevel++;this.resetPlayerInput();if(this.playerLevel>=20){this.setupGame();return}this.playCurrentLevel()},doFailureState:function t(){if(this.strictMode){this.resetGame();return}this.resetPlayerInput();this.playCurrentLevel()},init:function t(){var e=document.querySelectorAll(".button");for(var n=0,i=e.length;n<i;n++){var s=e[n];s.addEventListener("touchstart",this.handleColorInput.bind(this,s.id,true));s.addEventListener("mousedown",this.handleColorInput.bind(this,s.id))}var r=document.querySelector("#info-main-btn");r.addEventListener("click",this.handleMainBtn.bind(this));var o=document.querySelector("#info-strict");o.addEventListener("click",this.handleStrictBtn.bind(this))},initSounds:function t(){if(this.gameSounds.loaded||this.gameSounds.loading){return}if(typeof Howl!="function"){return Promise.reject(new Error("Sound effects require Howler.js to be loaded"))}var e=this.colors.concat("wrong");var n={green:"assets/sounds/NFF-good-tip-high",red:"assets/sounds/NFF-good-tip-low",yellow:"assets/sounds/NFF-good-tip-high-2",blue:"assets/sounds/NFF-good-tip-low-2",wrong:"assets/sounds/NFF-wrong"};for(var i in n){if(n.hasOwnProperty(i)){var s=[n[i]+".mp3",n[i]+".ogg"];this.gameSounds[i]=new Howl({src:s})}}this.gameSounds.loading=true;var r=[];var o=this;var u=function t(n,i){r.push(new Promise(function(t,i){o.gameSounds[e[n]].once("load",function(){t(true)})}))};for(var a=0,l=e.length;a<l;a++){u(a,l)}return new Promise(function(t,e){Promise.all(r).then(function(){o.gameSounds.loading=false;o.gameSounds.loaded=true;t(true)})})},setMainBtn:function t(e){document.querySelector("#info-main-btn").innerHTML=e},setLevelField:function t(){var e=this.playerLevel||0;document.querySelector("#info-level").innerHTML=e},setStrictField:function t(){var e="Strict Mode "+(this.strictMode?"On":"Off");document.querySelector("#info-strict").innerHTML=e},handleMainBtn:function t(){if(!this.started){this.startGame()}else{if(this.resetting){return}this.resetGame()}},handleStrictBtn:function t(){this.strictMode=!this.strictMode;var e=document.querySelector("#info-strict");var n=this.strictMode?"strict":"";var i="Strict Mode ";i+=this.strictMode?"On":"Off";e.innerHTML=i;e.setAttribute("class",n)},handleColorInput:function t(e,n){if(this.pauseInput||this.touchTimeout){return false}if(n){this.touchTimeout=true;setTimeout(function(){this.touchTimeout=false}.bind(this),300)}this.animateButton(e);var i=this.input(e);if(i){this.inputSucceed(e);return true}else{this.inputFail();return false}},inputSucceed:function t(e){this.playSound(e)},inputFail:function t(){this.playSound("wrong")},animateButton:function t(e){var n=document.querySelector("."+e);if(!n){return}var i="button "+e;var s=n.getAttribute("class").split(" ");if(s.indexOf("active")==-1){s.push("active")}else{var r=n.cloneNode(true);r.setAttribute("class",i);r.addEventListener("mousedown",this.handleColorInput.bind(this,n.id));n.parentNode.replaceChild(r,n);n=r}n.setAttribute("class",s.join(" "));return new Promise(function(t,e){setTimeout(function(){if(n.getAttribute("class")!=i){n.setAttribute("class",i)}t(true)},600)})},playSequence:function t(e,n){var i=this.sequence;e=e||i.length;n=Math.floor(n*1e3)||1e3;var s=this;var r=[];var o=Math.floor(Math.random()*1e4);this.animationId=o;var u=function t(e){r.push(new Promise(function(t,r){setTimeout(function(){if(s.animationId!=o){t(false);return}s.playSound(i[e]);s.animateButton(i[e]).then(function(){t()})},n*e)}))};for(var a=0;a<e;a++){u(a)}var l=Promise.all(r);return l},playSound:function t(e){if(this.gameSounds.hasOwnProperty(e)){var n=this.gameSounds[e];n.currentTime=0;n.play()}}};GAME.init();